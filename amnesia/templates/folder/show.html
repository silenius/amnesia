<metal:block use-macro="load: ../layout.html"
             tal:define="content item">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <metal:block fill-slot="title_more">: ${item.title}</metal:block>
        <script metal:fill-slot="head-bottom" type="text/javascript" tal:define="default_browse cherrypy.session.get('folder_browse', dict()); default_limit default_browse.get('limit', 10) ; default_view default_browse.get('display', 'list') ;" tal:condition="not item.alternate_index">

            /* <![CDATA[ */

            document.addEventListener("DOMContentLoaded", function(e) {
                var folder = new Bbpf.Folder(${h.dump_obj(item, 'json', exclude_columns=['fts', 'position_in_container'], include_relations=['state'])}),
                    spinner = new Bbpf.Spinner({
                        target : 'spinner',
                        images : {
                            load : "${url('/images/spinner.gif')}",
                            error : "${url('/images/exclamation.png')}"
                        }
                    }), 
                    pagination = new Bbpf.Pagination({}),
                    folder_browser = new Bbpf.FolderController({
                        url : "${item.url_for('browse')}",
                        folder : folder,
                        components : {
                            main : new Bbpf.Component({
                                container : 'content'
                            }),
                            pagination : new Bbpf.PaginationComponent({
                                container : 'pagination',
                                pagination : pagination
                            })
                        },
                        parameters : {
                            display : "${default_view}",
                            limit : pagination.get('limit')
                        }
                    })
                ; // var

                pagination.dispatcher.add('pagination_change', function() {
                    folder_browser.refresh({
                        limit: this.get('limit'),
                        offset: this.get('offset')
                    });
                });

                folder_browser.dispatcher.add('before_load', function() {
                    spinner.set('load');
                });

                folder_browser.dispatcher.add('after_load_success', function() {
                    spinner.hide();
                });

                folder_browser.dispatcher.add('after_load_failure', function() {
                    spinner.set('error');
                });

                Yeti.Element('order_add').addEventListener('click', function(e) {
                    folder_browser.add_sort(new Bbpf.FolderSort({
                        key: Yeti.Element('order_field').value,
                        dir: Yeti.Element('order_dir').value,
                        nulls: Yeti.Element('order_nulls').value
                    }));
                });

                folder_browser.load();
            });

            /* ]]> */

        </script>
    </head>

    <body>
    <div metal:fill-slot="content" id="main">
   <metal:block tal:define="replace load: ../page/show.html; item content.alternate_index"
           tal:condition="content.alternate_index"
           metal:use-macro="replace['body']">
        <div class="right" style="margin-right:10px" metal:fill-slot="actions" tal:condition="user">
            <metal:block use-macro="load: ../folder/_action_buttons.html" tal:define="content content" />
        </div>
    </metal:block>

    <div tal:condition="not item.alternate_index">
        <!-- BEGIN: BODY -->

        <!-- BEGIN: TITLE -->

        <div class="title folder_title">

            <div class="right">
                <a tal:condition="item.rss" href="${item.url_for('rss')}"><img src="${url('/images/rss.png')}" style="margin-right:5px" /></a>
                <metal:block use-macro="load: ../content/_share_buttons.html" />
            </div>

            <div class="right" style="margin-right:10px" tal:condition="user">
                <metal:block use-macro="load: ../folder/_action_buttons.html" tal:define="content item" />
            </div>

            <h1>
                ${item.title}
                <img src="${url('/images/spinner.gif')}" style="vertical-align:middle;" id="spinner" />
            </h1>


        </div>
        <div>
            Sort by:
            <select id="order_field">
                <option tal:repeat="(k, v) orders.items()" value="${k}">
                    <a class="sort" href="#" data-key="${k}" data-json="${v.fmt_json()}">${v.doc}</a>
                </option>
            </select>
            Direction: <select id="order_dir"><option>asc</option><option>desc</option></select>
            Nulls: <select id="order_nulls"><option>first</option><option>last</option></select>
            <a href="#" id="order_add">add</a>
        </div>

 
        <!-- END: TITLE -->

        <!-- BEGIN: DESCRIPTION -->

        <h2 class="description">${item.description}</h2>

        <div id="content">
            Loading... please wait
        </div>

        <!-- END: DESCRIPTION -->

        <div id="pagination">
            <!-- PAGINATION -->
        </div>

        <!-- END: BODY -->

    </div>

    </div>
    </body>

</html>
</metal:block>
