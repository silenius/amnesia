<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?python
    import json
?>
<response tal:define="page_total int((count / req['limit'] if count % req['limit'] == 0 else count / req['limit'] + 1)) ; page_current int((req['offset'] / req['limit'] + 1));">

    <meta>
        <requested tal:condition="req">${json.dumps(req)}</requested>
        <errors>
            <error tal:repeat="error errors | ()" level="${error.level}">${error.message}</error>
        </errors>
    </meta>

    <components tal:define="components req['components'] | ('main', 'pagination')">

        <navigation tal:condition="'navigation' in components" xmlns="http://www.w3.org/1999/xhtml">
            ${structure: widgets.Navigation(content.id, obj_dump=obj_dump)}
        </navigation>

        <main tal:condition="'main' in components" xmlns="http://www.w3.org/1999/xhtml">
            <metal:block use-macro="load: _browse.html" tal:define="display req['display']; sort req['sort']; options req['options']" />
        </main>

        <pagination tal:condition="'pagination' in components" xmlns="http://www.w3.org/1999/xhtml" count="${count}" limit="${req['limit']}" offset="${req['offset']}" page_total="${page_total}" page_current="${page_current}">
            <metal:block use-macro="load: ../_pagination.html" tal:define="offset req['offset']; limit req['limit']" />
        </pagination>

    </components>

</response>
